<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Deep Link Buttons (mobile)</title>
  <style>
    :root{--bg:#f7f7f7;--card:#fff;--primary:#2563eb;--accent:#0ea5a4;--muted:#6b7280}
    html,body{height:100%;margin:0}
    body { font-family: system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; background:var(--bg); display:flex; align-items:flex-start; justify-content:center; padding:20px 16px; }
    .wrap{width:100%;max-width:720px}
    .card{background:var(--card);border-radius:12px;padding:16px;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
    h1{font-size:18px;margin:0 0 8px}
    p.lead{margin:0 0 12px;color:var(--muted);font-size:13px}

    .field{display:flex;gap:8px;align-items:center;margin-bottom:12px}
    .field .label{min-width:86px;font-weight:600;font-size:14px}
    .field input[type="text"]{flex:1;padding:12px 12px;border-radius:10px;border:1px solid #e5e7eb;font-size:15px}
    .field button.small{padding:10px 12px;border-radius:10px;border:0;background:#f3f4f6;color:#111;font-weight:600;cursor:pointer}

    .controls{display:flex;gap:8px;margin-bottom:12px}
    .controls button{flex:1;padding:12px 14px;border-radius:10px;border:0;cursor:pointer;font-weight:700;color:#fff}
    .controls .save{background:var(--primary)}
    .controls .reset{background:#374151}

    .links{display:flex;flex-direction:column;gap:10px;margin-top:4px}
    .link-btn{display:inline-flex;align-items:center;justify-content:center;padding:14px;border-radius:12px;background:var(--primary);color:#fff;text-decoration:none;font-weight:800;font-size:16px}
    .link-btn.secondary{background:var(--accent)}

    .note{margin-top:12px;color:var(--muted);font-size:13px}

    /* toast */
    .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:18px;background:rgba(0,0,0,0.85);color:#fff;padding:10px 14px;border-radius:10px;font-size:14px;display:none;z-index:1200}
    .toast.show{display:block;animation:toastIn .22s ease}
    @keyframes toastIn{from{opacity:0;transform:translateX(-50%) translateY(8px)}to{opacity:1;transform:translateX(-50%) translateY(0)}}

    @media(min-width:880px){body{padding:40px}h1{font-size:20px}}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" role="main">
      <h1>Deep Link ‚Äî –º–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è</h1>
      <p class="lead">–ò–∑–º–µ–Ω—è–π—Ç–µ –∏ –æ—Ç–∫—Ä—ã–≤–∞–π—Ç–µ —Å—Ö–µ–º—ã –ø—Ä—è–º–æ —Å —Ç–µ–ª–µ—Ñ–æ–Ω–∞. –ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ ‚Äî –ø–æ–ª—É—á–∏—Ç–µ –ø–æ–¥—Å–∫–∞–∑–∫—É –∏ —Å–º–æ–∂–µ—Ç–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É.</p>

      <div class="field">
        <div class="label">–°—Ö–µ–º–∞ 1</div>
        <input id="link1" type="text" inputmode="url" autocomplete="off" placeholder="atb360://open-banking/callback" aria-label="–°—Ö–µ–º–∞ 1" />
        <button class="small" id="paste1" title="–í—Å—Ç–∞–≤–∏—Ç—å –∏–∑ –±—É—Ñ–µ—Ä–∞">üìã</button>
      </div>

      <div class="field">
        <div class="label">–°—Ö–µ–º–∞ 2</div>
        <input id="link2" type="text" inputmode="url" autocomplete="off" placeholder="atb360dev://open-banking/callback" aria-label="–°—Ö–µ–º–∞ 2" />
        <button class="small" id="paste2" title="–í—Å—Ç–∞–≤–∏—Ç—å –∏–∑ –±—É—Ñ–µ—Ä–∞">üìã</button>
      </div>

      <div class="controls">
        <button id="save" class="save">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <button id="reset" class="reset">–°–±—Ä–æ—Å–∏—Ç—å</button>
      </div>

      <div class="links">
        <a id="btn1" class="link-btn" href="#" role="button" aria-label="–û—Ç–∫—Ä—ã—Ç—å –ø–µ—Ä–≤—É—é —Å—Ö–µ–º—É">Open</a>
        <a id="btn2" class="link-btn secondary" href="#" role="button" aria-label="–û—Ç–∫—Ä—ã—Ç—å –≤—Ç–æ—Ä—É—é —Å—Ö–µ–º—É">Open</a>
      </div>

      <p class="note">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤—Å—Ç–∞–≤–∫–∞ –∏–∑ –±—É—Ñ–µ—Ä–∞ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ. –ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –æ—Ç–∫—Ä—ã—Ç—å –∫–∞—Å—Ç–æ–º–Ω—É—é —Å—Ö–µ–º—É –±—Ä–∞—É–∑–µ—Ä –º–æ–∂–µ—Ç –ø–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç ‚Äî –≤ —ç—Ç–æ–º —Å–ª—É—á–∞–µ –ø–æ—è–≤–∏—Ç—Å—è –ø–æ–¥—Å–∫–∞–∑–∫–∞.</p>
    </div>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <script>
    (function(){
      const DEFAULT_1 = "atb360://open-banking/callback";
      const DEFAULT_2 = "atb360dev://open-banking/callback";
      const inp1 = document.getElementById('link1');
      const inp2 = document.getElementById('link2');
      const btn1 = document.getElementById('btn1');
      const btn2 = document.getElementById('btn2');
      const save = document.getElementById('save');
      const reset = document.getElementById('reset');
      const paste1 = document.getElementById('paste1');
      const paste2 = document.getElementById('paste2');
      const toast = document.getElementById('toast');

      function showToast(text, ms = 3500){
        toast.textContent = text;
        toast.classList.add('show');
        clearTimeout(toast._t);
        toast._t = setTimeout(()=>{toast.classList.remove('show')}, ms);
      }

      function load(){
        inp1.value = localStorage.getItem('link1') || DEFAULT_1;
        inp2.value = localStorage.getItem('link2') || DEFAULT_2;
        apply();
      }

      function apply(){
        const v1 = inp1.value.trim() || DEFAULT_1;
        const v2 = inp2.value.trim() || DEFAULT_2;
        btn1.href = v1;
        btn2.href = v2;
        btn1.textContent = 'Open ' + (v1.split(':')[0] || 'app');
        btn2.textContent = 'Open ' + (v2.split(':')[0] || 'app');
      }

      // Clipboard paste helpers
      async function pasteInto(input){
        try{
          const text = await navigator.clipboard.readText();
          if(text) { input.value = text; apply(); showToast('–í—Å—Ç–∞–≤–ª–µ–Ω–æ –∏–∑ –±—É—Ñ–µ—Ä–∞'); }
          else showToast('–ë—É—Ñ–µ—Ä –ø—É—Å—Ç');
        }catch(e){
          showToast('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –±—É—Ñ–µ—Ä—É');
        }
      }

      paste1.addEventListener('click', ()=> pasteInto(inp1));
      paste2.addEventListener('click', ()=> pasteInto(inp2));

      // Live update
      inp1.addEventListener('input', apply);
      inp2.addEventListener('input', apply);

      save.addEventListener('click', ()=>{
        localStorage.setItem('link1', inp1.value.trim());
        localStorage.setItem('link2', inp2.value.trim());
        apply();
        showToast('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ');
      });

      reset.addEventListener('click', ()=>{
        localStorage.removeItem('link1');
        localStorage.removeItem('link2');
        load();
        showToast('–°–±—Ä–æ—à–µ–Ω–æ');
      });

      // Open link with fallback detection
      function openWithFallback(url){
        // –ï—Å–ª–∏ —ç—Ç–æ http/https ‚Äî –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–π—Ç–∏
        try{
          const scheme = (url.split(':')[0] || '').toLowerCase();
          if(scheme === 'http' || scheme === 'https'){
            window.location.href = url;
            return;
          }
        }catch(e){}

        let opened = false;
        const iframe = document.createElement('iframe');
        iframe.style.display = 'none';
        // timeout: –µ—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –æ—Ç–∫—Ä—ã–ª–æ—Å—å ‚Äî –ø–æ–∫–∞–∂–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É
        const start = Date.now();
        let timer = setTimeout(()=>{
          // –µ—Å–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç –Ω–µ —Å–∫—Ä—ã—Ç ‚Äî –∑–Ω–∞—á–∏—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –æ—Ç–∫—Ä—ã–ª–æ—Å—å
          if(!document.hidden && Date.now() - start > 1200){
            showToast('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–ø—É—â–µ–Ω–æ. –ù–∞–∂–º–∏—Ç–µ –∏ —É–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ –∫–Ω–æ–ø–∫—É, —á—Ç–æ–±—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É.');
          }
          cleanup();
        }, 1200);

        function cleanup(){
          clearTimeout(timer);
          if(iframe.parentNode) iframe.parentNode.removeChild(iframe);
        }

        // –ï—Å–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å—Ç–∞–Ω–µ—Ç —Å–∫—Ä—ã—Ç–∞ ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ—à—ë–ª –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ -> –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ—Å—Ç
        function onVisibility(){
          if(document.hidden){
            opened = true;
            cleanup();
          }
        }

        document.addEventListener('visibilitychange', onVisibility);
        // –ü–æ–ø—ã—Ç–∫–∞ –æ—Ç–∫—Ä—ã—Ç—å —Å—Ö–µ–º—É —á–µ—Ä–µ–∑ iframe
        try{
          iframe.src = url;
          document.body.appendChild(iframe);
        }catch(e){
          // –∫–∞–∫ fallback –ø—Ä–æ–±—É–µ–º –º–µ–Ω—è—Ç—å location
          try{ window.location.href = url; }catch(_){ }
        }

        // –û—á–∏—Å—Ç–∫–∞ —á–µ—Ä–µ–∑ –ø–∞—Ä—É —Å–µ–∫—É–Ω–¥
        setTimeout(()=>{ document.removeEventListener('visibilitychange', onVisibility); cleanup(); }, 2500);
      }

      // Long press to copy link (mobile friendly)
      function attachLongPress(el, getUrl){
        let pressTimer = null;
        const onStart = (e)=>{
          pressTimer = setTimeout(()=>{
            const url = getUrl();
            navigator.clipboard?.writeText(url).then(()=> showToast('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä'))
              .catch(()=> showToast('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å'));
          }, 500);
        };
        const onEnd = ()=>{ clearTimeout(pressTimer); };
        el.addEventListener('touchstart', onStart);
        el.addEventListener('mousedown', onStart);
        el.addEventListener('touchend', onEnd);
        el.addEventListener('mouseup', onEnd);
        el.addEventListener('mouseleave', onEnd);
      }

      // Attach listeners to buttons
      btn1.addEventListener('click', function(e){ e.preventDefault(); openWithFallback(this.href); });
      btn2.addEventListener('click', function(e){ e.preventDefault(); openWithFallback(this.href); });

      attachLongPress(btn1, ()=>btn1.href);
      attachLongPress(btn2, ()=>btn2.href);

      // init
      load();

      // Accessibility: allow Enter on inputs to open link for convenience
      inp1.addEventListener('keydown', (e)=>{ if(e.key === 'Enter') { openWithFallback(inp1.value.trim() || DEFAULT_1); } });
      inp2.addEventListener('keydown', (e)=>{ if(e.key === 'Enter') { openWithFallback(inp2.value.trim() || DEFAULT_2); } });

    })();
  </script>
</body>
</html>
