<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Deep Links (mobile)</title>
  <style>
    :root{--bg:#f7f7f7;--card:#fff;--primary:#2563eb;--accent:#0ea5a4;--muted:#6b7280}
    html,body{height:100%;margin:0}
    body { font-family: system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; background:var(--bg); display:flex; align-items:flex-start; justify-content:center; padding:20px 16px; }
    .wrap{width:100%;max-width:720px}
    .card{background:var(--card);border-radius:12px;padding:16px;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
    h1{font-size:18px;margin:0 0 8px}
    p.lead{margin:0 0 12px;color:var(--muted);font-size:13px}

    /* Field: label above input */
    .field{display:flex;flex-direction:column;gap:8px;align-items:stretch;margin-bottom:12px}
    .field .label{font-weight:700;font-size:13px;color:#111}
    .inputrow{display:flex;gap:8px;align-items:center}
    .inputrow input[type="text"]{flex:1;padding:12px 12px;border-radius:10px;border:1px solid #e5e7eb;font-size:15px}
    .inputrow button.small{padding:10px 12px;border-radius:10px;border:0;background:#f3f4f6;color:#111;font-weight:600;cursor:pointer}

    .controls{display:flex;gap:8px;margin-bottom:12px}
    .controls button{flex:1;padding:12px 14px;border-radius:10px;border:0;cursor:pointer;font-weight:700;color:#fff}
    .controls .save{background:var(--primary)}
    .controls .reset{background:#374151}

    .links{display:flex;flex-direction:column;gap:10px;margin-top:4px}
    .link-btn{display:inline-flex;align-items:center;justify-content:center;padding:14px;border-radius:12px;background:var(--primary);color:#fff;text-decoration:none;font-weight:800;font-size:16px}
    .link-btn.secondary{background:var(--accent)}

    .note{margin-top:12px;color:var(--muted);font-size:13px}

    /* toast */
    .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:18px;background:rgba(0,0,0,0.85);color:#fff;padding:10px 14px;border-radius:10px;font-size:14px;display:none;z-index:1200}
    .toast.show{display:block;animation:toastIn .22s ease}
    @keyframes toastIn{from{opacity:0;transform:translateX(-50%) translateY(8px)}to{opacity:1;transform:translateX(-50%) translateY(0)}}

    @media(min-width:880px){body{padding:40px}h1{font-size:20px}}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" role="main">
      <h1>Deep Links â€” Mobile</h1>
      <p class="lead">Edit and open deep links from your phone. If the target app is not installed you'll get a hint and can copy the link.</p>

      <div class="field">
        <div class="label">prod</div>
        <div class="inputrow">
          <input id="link1" type="text" inputmode="url" autocomplete="off" placeholder="atb360://open-banking/callback" aria-label="prod link" />
          <button class="small" id="paste1" title="Paste from clipboard">ðŸ“‹</button>
        </div>
      </div>

      <div class="field">
        <div class="label">dev</div>
        <div class="inputrow">
          <input id="link2" type="text" inputmode="url" autocomplete="off" placeholder="atb360dev://open-banking/callback" aria-label="dev link" />
          <button class="small" id="paste2" title="Paste from clipboard">ðŸ“‹</button>
        </div>
      </div>

      <div class="controls">
        <button id="save" class="save">Save</button>
        <button id="reset" class="reset">Reset</button>
      </div>

      <div class="links">
        <a id="btn1" class="link-btn" href="#" role="button" aria-label="Open prod">Open prod</a>
        <a id="btn2" class="link-btn secondary" href="#" role="button" aria-label="Open dev">Open dev</a>
      </div>

      <p class="note">Supports clipboard paste and auto-save. When opening a custom scheme the browser may prompt or nothing may happen â€” in that case you'll see a hint.</p>
    </div>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <script>
    (function(){
      const DEFAULT_1 = "atb360://open-banking/callback";
      const DEFAULT_2 = "atb360dev://open-banking/callback";
      const inp1 = document.getElementById('link1');
      const inp2 = document.getElementById('link2');
      const btn1 = document.getElementById('btn1');
      const btn2 = document.getElementById('btn2');
      const save = document.getElementById('save');
      const reset = document.getElementById('reset');
      const paste1 = document.getElementById('paste1');
      const paste2 = document.getElementById('paste2');
      const toast = document.getElementById('toast');

      function showToast(text, ms = 3500){
        toast.textContent = text;
        toast.classList.add('show');
        clearTimeout(toast._t);
        toast._t = setTimeout(()=>{toast.classList.remove('show')}, ms);
      }

      function load(){
        inp1.value = localStorage.getItem('link1') || DEFAULT_1;
        inp2.value = localStorage.getItem('link2') || DEFAULT_2;
        apply();
      }

      function apply(){
        const v1 = inp1.value.trim() || DEFAULT_1;
        const v2 = inp2.value.trim() || DEFAULT_2;
        btn1.href = v1;
        btn2.href = v2;
        btn1.textContent = 'Open prod';
        btn2.textContent = 'Open dev';
      }

      // Clipboard paste helpers
      async function pasteInto(input){
        try{
          const text = await navigator.clipboard.readText();
          if(text) { input.value = text; apply(); showToast('Pasted from clipboard'); }
          else showToast('Clipboard is empty');
        }catch(e){
          showToast('Cannot access clipboard');
        }
      }

      paste1.addEventListener('click', ()=> pasteInto(inp1));
      paste2.addEventListener('click', ()=> pasteInto(inp2));

      // Live update
      inp1.addEventListener('input', apply);
      inp2.addEventListener('input', apply);

      save.addEventListener('click', ()=>{
        localStorage.setItem('link1', inp1.value.trim());
        localStorage.setItem('link2', inp2.value.trim());
        apply();
        showToast('Saved');
      });

      reset.addEventListener('click', ()=>{
        localStorage.removeItem('link1');
        localStorage.removeItem('link2');
        load();
        showToast('Reset');
      });

      // Open link with fallback detection
      function openWithFallback(url){
        // If http/https â€” just navigate
        try{
          const scheme = (url.split(':')[0] || '').toLowerCase();
          if(scheme === 'http' || scheme === 'https'){
            window.location.href = url;
            return;
          }
        }catch(e){}

        let opened = false;
        const iframe = document.createElement('iframe');
        iframe.style.display = 'none';
        // timeout: if app not opened â€” show hint
        const start = Date.now();
        let timer = setTimeout(()=>{
          if(!document.hidden && Date.now() - start > 1200){
            showToast('App did not open. Long-press the button to copy the link.');
          }
          cleanup();
        }, 1200);

        function cleanup(){
          clearTimeout(timer);
          if(iframe.parentNode) iframe.parentNode.removeChild(iframe);
        }

        function onVisibility(){
          if(document.hidden){
            opened = true;
            cleanup();
          }
        }

        document.addEventListener('visibilitychange', onVisibility);
        try{
          iframe.src = url;
          document.body.appendChild(iframe);
        }catch(e){
          try{ window.location.href = url; }catch(_){ }
        }

        setTimeout(()=>{ document.removeEventListener('visibilitychange', onVisibility); cleanup(); }, 2500);
      }

      // Long press to copy link (mobile friendly)
      function attachLongPress(el, getUrl){
        let pressTimer = null;
        const onStart = (e)=>{
          pressTimer = setTimeout(()=>{
            const url = getUrl();
            navigator.clipboard?.writeText(url).then(()=> showToast('Link copied to clipboard'))
              .catch(()=> showToast('Copy failed'));
          }, 500);
        };
        const onEnd = ()=>{ clearTimeout(pressTimer); };
        el.addEventListener('touchstart', onStart);
        el.addEventListener('mousedown', onStart);
        el.addEventListener('touchend', onEnd);
        el.addEventListener('mouseup', onEnd);
        el.addEventListener('mouseleave', onEnd);
      }

      // Attach listeners to buttons
      btn1.addEventListener('click', function(e){ e.preventDefault(); openWithFallback(this.href); });
      btn2.addEventListener('click', function(e){ e.preventDefault(); openWithFallback(this.href); });

      attachLongPress(btn1, ()=>btn1.href);
      attachLongPress(btn2, ()=>btn2.href);

      // init
      load();

      // Accessibility: allow Enter on inputs to open link for convenience
      inp1.addEventListener('keydown', (e)=>{ if(e.key === 'Enter') { openWithFallback(inp1.value.trim() || DEFAULT_1); } });
      inp2.addEventListener('keydown', (e)=>{ if(e.key === 'Enter') { openWithFallback(inp2.value.trim() || DEFAULT_2); } });

    })();
  </script>
</body>
</html>
